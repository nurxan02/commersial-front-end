{% extends "admin/change_form.html" %} {% load i18n static %} {% block extrahead %} {{ block.super }}
<style>
  .status-selector {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 0.5rem;
    margin: 1rem 0;
    padding: 1rem;
    background: var(--color-base-50);
    border-radius: var(--border-radius, 6px);
    border: 1px solid var(--color-base-200);
  }

  .dark .status-selector {
    background: var(--color-base-800);
    border-color: var(--color-base-700);
  }

  .status-option {
    padding: 0.75rem;
    border-radius: var(--border-radius, 6px);
    border: 2px solid transparent;
    cursor: pointer;
    text-align: center;
    font-weight: 600;
    font-size: 0.875rem;
    transition: all 0.2s;
    text-transform: uppercase;
    letter-spacing: 0.025em;
  }

  .status-option.pending {
    background: #fef3c7;
    color: #92400e;
  }

  .status-option.processing {
    background: #dbeafe;
    color: #1e40af;
  }

  .status-option.shipped {
    background: #d1fae5;
    color: #065f46;
  }

  .status-option.delivered {
    background: #d1fae5;
    color: #065f46;
  }

  .status-option.cancelled {
    background: #fee2e2;
    color: #991b1b;
  }

  .status-option.active {
    border-color: var(--color-primary-600);
    box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.2);
  }

  .status-option:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  .order-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin: 1rem 0;
  }

  .summary-card {
    padding: 1rem;
    background: var(--color-white);
    border: 1px solid var(--color-base-200);
    border-radius: var(--border-radius, 6px);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
  }

  .dark .summary-card {
    background: var(--color-base-900);
    border-color: var(--color-base-700);
  }

  .summary-title {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--color-base-600);
    margin-bottom: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.025em;
  }

  .dark .summary-title {
    color: var(--color-base-400);
  }

  .summary-value {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--color-base-900);
  }

  .dark .summary-value {
    color: var(--color-base-100);
  }

  .profit-positive {
    color: #10b981;
  }

  .profit-negative {
    color: #ef4444;
  }

  @media (max-width: 768px) {
    .status-selector {
      grid-template-columns: 1fr;
    }

    .order-summary {
      grid-template-columns: 1fr;
    }
  }
</style>
{% endblock %} {% block field_sets %} {% if original %}
<fieldset class="module aligned">
  <h2>Sifariş Statusu</h2>
  <div class="status-selector">
    <div class="status-option pending" data-status="pending">Gözləyir</div>
    <div class="status-option processing" data-status="processing">İşlənir</div>
    <div class="status-option shipped" data-status="shipped">Göndərildi</div>
    <div class="status-option delivered" data-status="delivered">
      Çatdırıldı
    </div>
    <div class="status-option cancelled" data-status="cancelled">
      Ləğv edildi
    </div>
  </div>
</fieldset>

<fieldset class="module aligned">
  <h2>Sifariş Xülasəsi</h2>
  <div class="order-summary">
    <div class="summary-card">
      <div class="summary-title">Müştəri</div>
      <div class="summary-value">
        {{ original.user.first_name }} {{ original.user.last_name }}
      </div>
      <div
        style="
          font-size: 0.875rem;
          color: var(--color-base-500);
          margin-top: 0.25rem;
        "
      >
        {{ original.user.email }}
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-title">Toplam Məbləğ</div>
      <div class="summary-value">{{ original.total_price }} AZN</div>
    </div>
    <div class="summary-card">
      <div class="summary-title">Sifariş Mənfəəti</div>
      <div class="summary-value" style="color: #10b981">
        {{ original.get_total_profit|floatformat:2 }} AZN
      </div>
      <div
        style="
          font-size: 0.75rem;
          color: var(--color-base-500);
          margin-top: 0.25rem;
        "
      >
        Satış qiyməti - maya dəyəri
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-title">Sifariş Tarixi</div>
      <div class="summary-value">{{ original.created_at|date:"d.m.Y" }}</div>
      <div
        style="
          font-size: 0.875rem;
          color: var(--color-base-500);
          margin-top: 0.25rem;
        "
      >
        {{ original.created_at|time:"H:i" }}
      </div>
    </div>
    <div class="summary-card">
      <div class="summary-title">Çatdırılma Ünvanı</div>
      <div class="summary-value" style="font-size: 1rem">
        {% if original.delivery_address %} {{ original.delivery_address.city }},
        {{ original.delivery_address.district }} {% if original.delivery_address.street %}
        <div
          style="
            font-size: 0.875rem;
            color: var(--color-base-500);
            margin-top: 0.25rem;
          "
        >
          Küçə: {{ original.delivery_address.street }}
        </div>
        {% endif %} {% if original.delivery_address.building %}
        <div style="font-size: 0.875rem; color: var(--color-base-500)">
          Mənzil/Ev: {{ original.delivery_address.building }}
        </div>
        {% endif %} {% if original.delivery_address.postal_code %}
        <div style="font-size: 0.875rem; color: var(--color-base-500)">
          Poçt kodu: {{ original.delivery_address.postal_code }}
        </div>
        {% endif %} {% else %} Təyin edilməyib {% endif %}
      </div>
    </div>
  </div>
</fieldset>

<fieldset class="module aligned">
  <h2>Sifariş Edilən Məhsullar</h2>
  <div class="order-summary">
    {% for item in original.items.all %}
    <div
      class="summary-card"
      style="
        border-left: 4px solid var(--color-primary-500);
        position: relative;
      "
    >
      <div class="summary-title">{{ item.product.name }}</div>
      <div class="summary-value" style="font-size: 1rem">
        {{ item.quantity }} ədəd × {{ item.unit_price }} AZN
      </div>
      <div
        style="
          font-size: 0.875rem;
          color: var(--color-base-600);
          margin-top: 0.5rem;
        "
      >
        <strong>Kateqoriya:</strong> {{ item.product.category.name }}
      </div>
      <div style="font-size: 0.875rem; color: var(--color-base-600)">
        <strong>Maya dəyəri:</strong> {{ item.product.cost_price }} AZN
      </div>
      <div style="font-size: 0.875rem; color: var(--color-base-600)">
        <strong>Satış qiyməti:</strong> {{ item.unit_price }} AZN
      </div>
      <div style="font-size: 0.875rem; margin-top: 0.25rem">
        <strong>Vahid mənfəət:</strong>
        <span
          class="{% if item.get_unit_profit > 0 %}profit-positive{% else %}profit-negative{% endif %}"
        >
          {{ item.get_unit_profit|floatformat:2 }} AZN
        </span>
      </div>
      <div
        style="
          font-size: 0.875rem;
          color: var(--color-base-500);
          margin-top: 0.5rem;
        "
      >
        <strong>Ara cəm:</strong> {{ item.subtotal }} AZN
      </div>
      {% if item.product.description %}
      <div
        style="
          font-size: 0.75rem;
          color: var(--color-base-500);
          margin-top: 0.5rem;
          border-top: 1px solid var(--color-base-200);
          padding-top: 0.5rem;
        "
      >
        {{ item.product.description|truncatechars:100 }}
      </div>
      {% endif %}
    </div>
    {% endfor %}
  </div>
</fieldset>
{% endif %}
{{ block.super }}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const statusOptions = document.querySelectorAll(".status-option");
    const statusField = document.querySelector("#id_status");

    if (statusField) {
      // Set initial active status
      const currentStatus = statusField.value;
      statusOptions.forEach((option) => {
        if (option.dataset.status === currentStatus) {
          option.classList.add("active");
        }
      });

      // Handle status clicks
      statusOptions.forEach((option) => {
        option.addEventListener("click", function () {
          const newStatus = this.dataset.status;

          // Update visual selection
          statusOptions.forEach((opt) => opt.classList.remove("active"));
          this.classList.add("active");

          // Update form field
          statusField.value = newStatus;

          // Auto-save (optional - you can remove this if you want manual save)
          if (confirm("Bu statusu dəyişdirmək istəyirsiniz?")) {
            // Trigger form change event
            statusField.dispatchEvent(new Event("change"));

            // Show success message
            const message = document.createElement("div");
            message.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: #10B981;
                        color: white;
                        padding: 12px 20px;
                        border-radius: 8px;
                        z-index: 9999;
                        font-weight: 600;
                    `;
            message.textContent =
              "Status dəyişdirildi. Dəyişiklikləri qeyd etmək üçün Yadda saxla düyməsini basın.";
            document.body.appendChild(message);

            setTimeout(() => message.remove(), 3000);
          }
        });
      });
    }
  });
</script>
{% endblock %}
